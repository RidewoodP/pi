<html>
<head>
<title>System Monitoring Graph</title>
<style>
  body { font-family: Arial, sans-serif; }
  canvas { max-width: 800px; }
</style>
</head>
<body>
<h2>System Monitoring Graph</h2>
<canvas id='metricsChart'></canvas>
<script>
function createChart(labels, cpuData, memData, diskData) {
    const ctx = document.getElementById('metricsChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'CPU Usage (%)', data: cpuData, borderColor: 'red', fill: false },
                { label: 'Memory Usage (%)', data: memData, borderColor: 'blue', fill: false },
                { label: 'Disk Usage (%)', data: diskData, borderColor: 'green', fill: false }
            ]
        },
        options: {
            responsive: true,
            scales: {
                x: { title: { display: true, text: 'Time' } },
                y: { title: { display: true, text: 'Usage (%)' }, beginAtZero: true }
            }
        }
    });
}

async function fetchData() {
    const response = await fetch('metrics.log');
    const text = await response.text();
    const lines = text.trim().split('\n').slice(1);
    const labels = [], cpuData = [], memData = [], diskData = [];
    lines.forEach(line => {
        const [timestamp, cpu, mem, disk] = line.split(',');
        labels.push(timestamp);
        cpuData.push(parseFloat(cpu));
        memData.push(parseFloat(mem));
        diskData.push(parseFloat(disk));
    });
    createChart(labels, cpuData, memData, diskData);
}

// Embed Chart.js manually
const chartJsScript = document.createElement('script');
chartJsScript.src = 'chart.js';
chartJsScript.onload = fetchData;
document.head.appendChild(chartJsScript);

setInterval(fetchData, 60000); // Auto-refresh every 60 seconds
</script>
</body>
</html>
